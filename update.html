<head>
    <link rel="stylesheet" href="update.css">
    <script src="update.js" defer></script>
</head>

<body>
    <style>@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap');</style>

    <div class="update-info">
        <img class="logo" src="icon.png" />
        <p class="desc">Une mise à jour du client Afaura est disponible !</p>
        <button class="btn-dl" id="DownloadLaunch" onclick="Download()">Télécharger</button>
        <div class="btn-dl progress" id="DownloadProgress">
            <div class="table">
                <div class="progress-table">
                    <svg class="progress-ring" width="30" height="30">
                        <circle class="progress-ring__circle" stroke="white" stroke-width="2" fill="transparent" r="13" cx="15" cy="15"/>
                    </svg>
                </div>
                <div class="data-table">
                    <p class="dtxt">Téléchargement</p>
                    <p class="dinfo" id="download-info">0% | 0Mb/s</p>
                </div>
            </div>
        </div>
        <p class="help">Un problème ? <a href="">Aide</a></p>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        ipcRenderer.on('download-progress', (event, progressObj) => {
            const percent = progressObj.percent.toFixed(2);
            setProgress(Math.floor(percent))
            const speedInMBps = (progressObj.bytesPerSecond / (1024 * 1024)).toFixed(2);
            document.getElementById('download-info').innerText = `${Math.floor(percent)}% | ${speedInMBps}Mb/s`;
        });

        function Download() { 
            document.getElementById('DownloadLaunch').style.display = "none";
            document.getElementById('DownloadProgress').style.display = "block";
            ipcRenderer.send('download_update');
        }

        // Animation Téléchargement
        var circle = document.querySelector('circle');
        var radius = circle.r.baseVal.value;
        var circumference = radius * 2 * Math.PI;

        circle.style.strokeDasharray = `${circumference} ${circumference}`;
        circle.style.strokeDashoffset = `${circumference}`;

        function setProgress(percent) {
            const offset = circumference - percent / 100 * circumference;
            circle.style.strokeDashoffset = offset;
        }
        setProgress(0)
    </script>

</body>